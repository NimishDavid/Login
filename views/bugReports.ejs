<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Bug Reports</title>
        <link rel="stylesheet" type="text/css" href="/style/bugReports.css">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    <body>
    <% include navbar %>
    <div class="container">
    	<div class="row">
			<div class="col-md-12">
                    <% if(typeof(resultAdmin) != 'undefined') { %>
                        <% if(state == 'unassigned') { %>
                            <div class="panel panel-primary resp">
            					<div class="panel-heading">
            						<h3 class="panel-title">Unassigned Bugs</h3>
            						<div class="pull-right">
            							<span class="clickable filter" data-toggle="tooltip" title="Toggle table filter" data-container="body">
                                            <i class="fa fa-filter" aria-hidden="true"></i>
            							</span>
            						</div>
            					</div>
            					<div class="panel-body">
            						<input type="text" class="form-control" id="dev-table-filter" data-action="filter" data-filters="#dev-table" placeholder="Filter Bugs" />
            					</div>
        					<table class="table table-hover table-responsive" id="dev-table">
        						<thead>
        							<tr>
        								<th>#</th>
        								<th>Name</th>
        								<th>Type</th>
                                        <th>Severity</th>
                                        <th>Priority</th>
                                        <th>Project</th>
                                        <th>Assign to</th>
                                        <th></th>
                                        <th></th>
        							</tr>
        						</thead>
                                <tbody>
                                <% for(i=0; i<resultAdmin.length; i++) {%>
                                    <% if(resultAdmin[i].status == 'Open') {%>

                                        <tr>
            								<td class="bug_id"><%= resultAdmin[i].bugID %></td>
            								<td><%= resultAdmin[i].bugName %></td>
            								<td><%= resultAdmin[i].bugType %></td>
                                            <td><%= resultAdmin[i].severity %></td>
                                            <td><%= resultAdmin[i].priority %></td>
                                            <td><%= resultAdmin[i].projectName %></td>
                                            <td class="dev_id">

                                                    <select class="form-control" name="developer"  required>
                                                     <option value="">Select Developer</option>
                                                         <% for(j=0;j<devs.length;j++) {%>
                                                             <option value= <%= devs[j].devID %> > <%= devs[j].devName %>  </option>
                                                        <% } %>
                                                    </select>
                                                    <div class="help-block with-errors"></div>

                                            </td>
                                            <td class="text-center">
                                                <button type="button" class="btn btn-sm btn-success" data-toggle="modal" data-target="#exampleModal" data-bug="<%= resultAdmin[i].bugID %>">View More</button>
                                            </td>
                                            <td class="text-center">
                                                <button class="btn btn-sm btn-primary update">Assign</button>
                                            </td>
            							</tr>

                                    <% } %>
                                <% } %>
        						</tbody>
        					</table>
                        <% } %> <!--If state is unassigned -->

                        <% if(state == 'assigned') { %>

                            <div class="panel panel-primary resp">
            					<div class="panel-heading">
            						<h3 class="panel-title">Assigned Bugs</h3>
            						<div class="pull-right">
            							<span class="clickable filter" data-toggle="tooltip" title="Toggle table filter" data-container="body">
                                            <i class="fa fa-filter" aria-hidden="true"></i>
            							</span>
            						</div>
            					</div>
            					<div class="panel-body">
            						<input type="text" class="form-control" id="dev-table-filter" data-action="filter" data-filters="#dev-table" placeholder="Filter Bugs" />
            					</div>
        					<table class="table table-hover" id="dev-table">
        						<thead>
        							<tr>
        								<th>Bug #</th>
        								<th>Name</th>
        								<th>Type</th>
        								<th>Severity</th>
                                        <th>Priority</th>
                                        <th>Project</th>
                                        <th>Assigned to</th>
                                        <th>Status</th>
                                        <th></th>
        							</tr>
        						</thead>
                                <tbody>
                                <% for(i=0; i<resultAdmin.length; i++) {%>
                                    <% if((resultAdmin[i].status != 'Open') && (resultAdmin[i].status != 'Closed')) {%>

                                        <tr>
            								<td class="bug_id"><%= resultAdmin[i].bugID %></td>
            								<td><%= resultAdmin[i].bugName %></td>
            								<td><%= resultAdmin[i].bugType %></td>
            								<td><%= resultAdmin[i].severity %></td>
                                            <td><%= resultAdmin[i].priority %></td>
                                            <td><%= resultAdmin[i].projectName %></td>
                                            <td><%= resultAdmin[i].assignedToName %></td>
                                            <td><%= resultAdmin[i].status %></td>
                                            <td>
                                                <button type="button" class="btn btn-sm btn-success" data-toggle="modal" data-target="#exampleModal" data-bug="<%= resultAdmin[i].bugID %>">View More</button>
                                            </td>
            							</tr>

                                    <% } %>
                                <% } %>
        						</tbody>
        					</table>

                        <% } %> <!-- If state is assigned -->

                        <% if(state == 'closed') { %>

                            <div class="panel panel-primary resp">
            					<div class="panel-heading">
            						<h3 class="panel-title">Closed Bugs</h3>
            						<div class="pull-right">
            							<span class="clickable filter" data-toggle="tooltip" title="Toggle table filter" data-container="body">
                                            <i class="fa fa-filter" aria-hidden="true"></i>
            							</span>
            						</div>
            					</div>
            					<div class="panel-body">
            						<input type="text" class="form-control" id="dev-table-filter" data-action="filter" data-filters="#dev-table" placeholder="Filter Bugs" />
            					</div>
        					<table class="table table-hover" id="dev-table">
        						<thead>
        							<tr>
                                        <th>Bug #</th>
        								<th>Name</th>
        								<th>Type</th>
        								<th>Severity</th>
                                        <th>Priority</th>
                                        <th>Project</th>
                                        <th>Assigned to</th>
                                        <th>Status</th>
                                        <th></th>
        							</tr>
        						</thead>
                                <tbody>
                                <% for(i=0; i<resultAdmin.length; i++) {%>
                                    <% if(resultAdmin[i].status == 'Closed') {%>

                                        <tr>
                                            <td class="bug_id"><%= resultAdmin[i].bugID %></td>
            								<td><%= resultAdmin[i].bugName %></td>
            								<td><%= resultAdmin[i].bugType %></td>
            								<td><%= resultAdmin[i].severity %></td>
                                            <td><%= resultAdmin[i].priority %></td>
                                            <td><%= resultAdmin[i].projectName %></td>
                                            <td><%= resultAdmin[i].assignedToName %></td>
                                            <td><%= resultAdmin[i].status %></td>
                                            <td>
                                                <button type="button" class="btn btn-sm btn-success" data-toggle="modal" data-target="#exampleModal" data-bug="<%= resultAdmin[i].bugID %>">View More</button>
                                            </td>
            							</tr>

                                    <% } %>
                                <% } %>
        						</tbody>
        					</table>

                        <% } %> <!-- Closed bugs -->

                        <% if(state == 'approve') { %>
                            <div class="panel panel-primary resp">
            					<div class="panel-heading">
            						<h3 class="panel-title">Bugs pending approval</h3>
            						<div class="pull-right">
            							<span class="clickable filter" data-toggle="tooltip" title="Toggle table filter" data-container="body">
                                            <i class="fa fa-filter" aria-hidden="true"></i>
            							</span>
            						</div>
            					</div>
            					<div class="panel-body">
            						<input type="text" class="form-control" id="dev-table-filter" data-action="filter" data-filters="#dev-table" placeholder="Filter Bugs" />
            					</div>
        					<table class="table table-hover" id="dev-table">
        						<thead>
        							<tr>
        								<th>Bug #</th>
        								<th>Name</th>
        								<th>Type</th>
                                        <th>Severity</th>
                                        <th>Priority</th>
                                        <th>Project</th>
                                        <th>Assigned to</th>
                                        <th>Status</th>
                                        <th></th>
                                        <th></th>
        							</tr>
        						</thead>
                                <tbody>
                                <% for(i=0; i<resultAdmin.length; i++) {%>
                                    <% if(resultAdmin[i].status == 'Approval') {%>

                                        <tr>
            								<td class="bug_id"><%= resultAdmin[i].bugid %></td>
            								<td><%= resultAdmin[i].bugname %></td>
            								<td><%= resultAdmin[i].bugtype %></td>
                                            <td><%= resultAdmin[i].severity %></td>
                                            <td><%= resultAdmin[i].priority %></td>
                                            <td><%= resultAdmin[i].projectName %></td>
                                            <td><%= resultAdmin[i].assignedto %></td>
                                            <td class="stat">
                                                <select class="form-control" name="status" onchange="rejectCheck($(this))">
                                                 <option value="">Select status</option>
                                                 <option value="Approve Reject">Reject</option>
                                                 <option value="Closed">Closed</option>
                                                </select>
                                                <div class="ifReject"  style="padding-top: 5px; display: none;">
                                                  <input type="text" name="reason" placeholder="Reason" class="form-control reason" maxlength="200">
                                                </div>
                                            </td>
                                            <td class="text-center">
                                                <button type="button" class="btn btn-sm btn-success" data-toggle="modal" data-target="#exampleModal" data-bug="<%= resultAdmin[i].bugid %>">View More</button>
                                            </td>
                                            <td>
                                                <button class="btn btn-sm btn-primary update">Save</button>
                                            </td>
            							</tr>

                                    <% } %>
                                <% } %>
        						</tbody>
        					</table>
                        <% } %> <!--If state is unassigned -->

                    <% } %> <!--If admin -->
				</div>
			</div>
		</div>
	</div>

    <script src="/table.js" charset="utf-8"></script>
    <% if(typeof(resultAdmin) != 'undefined') { %>
        <% if(state == 'unassigned') { %>
            <script src="/assignDeveloper.js" charset="utf-8"></script>
        <% } %>
        <% if(state == 'approve') { %>
            <script src="/adminStatusUpdate.js" charset="utf-8"></script>
            <script src="/rejectReason.js" charset="utf-8"></script>
        <% } %>
    <% } %>
    <script src="/axios.min.js" charset="utf-8"></script>
    <script src="/getBugDetails.js" charset="utf-8"></script>
    </body>
</html>
